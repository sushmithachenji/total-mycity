<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotels</title>
    <link rel="stylesheet" th:href="@{/CSS/hotelss.css}">

</head>

<body>
    <div class="hotelDetailsContainer">

        <section class="navbar-container">
            <nav class="navBar">
                <img src="/images/lOGO.png" alt="MyCity Logo" width="50px" class="cityLogo">
                <div class="navItems">
                    <div class="navlinks">
                        <a href="mycity-homepage">Home</a>
                        <a href="entertainment">Entertainment</a>
                        <a href="homePage">Shopping</a>
                        <a href="tourism">Tourism</a>
                        <a href="beauty">Pay Bills</a>
                        <a href="ex">Hotels</a>
                    </div>
                    <a class="booknow">
                        Book Now
                    </a>
                </div>
            </nav>
        </section>

        <section class="hotel-images">
            <!-- Main image -->
            <img th:src="'data:image/jpeg;base64,' + ${relatedImages[0]?.hotelImageBase64}" alt="Main Image"
                id="mainimage">

            <!-- Side images -->
            <div class="side-images" id="side-image">
                <img th:each="image, iterStat : ${relatedImages}" th:if="${iterStat.index > 0}"
                    th:src="'data:image/jpeg;base64,' + ${image.hotelImageBase64}" alt="Hotel Image">
            </div>
        </section>

        <section class="tabMenu">
            <div class="registration">
                <div class="roomsDetails">
                    <!--   <p class="overview active">Overview & Amenities</p>
                    <p class="booking ">Rooms & Accessiblity</p> -->
                    <p class="overview active" onclick="toggleSection('overview')">Overview & Amenities</p>
                    <p class="booking" onclick="toggleSection('accessibility')">Rooms & Accessibility</p>
                </div>

                <!--  <a class="reserveNow" href="#" onclick="reserveHotel()">Reserve Now</a> -->

            </div>
            <hr class="tabline">
        </section>

        <section class="overview-Amenties active" id="overview">
            <div class="hotelDetails">
                <div class="headers" id="headers">

                    <h1 class="hotelName2" th:text="${hotel.name}"></h1>

                    <div class="hotelDescBox">
                        <p class="hotelDesc" th:text="${hotel.description}"></p>


                        <div class="highlights">
                            <!-- Iterate through hotel amenities -->
                            <div th:each="hotelAmenity : ${hotel.hotelAmenities}" class="featuresHighlights">
                                <img src="/icons/checkgreen.svg" alt="Check Green" class="CheckGreen">
                                <p class="feature" th:text="${hotelAmenity.amenity.name}"></p>
                            </div>
                        </div>

                    </div>



                </div>

                <div class="RatingBox">
                    <div class="starBox">
                        <p class="rating" th:text="${hotel.rating}"></p>
                        <img src="/icons/star.svg" alt="star" class="star">
                    </div>

                </div>


                <a class="fullReview" href="">
                    <p>See full reviews</p>
                    <img src="/icons/arrowright.svg" alt="arrow right" class="arrowimg">
                </a>

                <div class="popularAmenities">
                    <h2 class="title">Popular Amenities</h2>
                    <div class="amenities-list">
                        <div class="amenity-item" style="display: flex;gap:10px;margin-bottom: 10px;">
                            <img src="/icons/circleorange.svg" alt="orange Circle">
                            <p class="amentiy">Front desk [24-hour]</p>
                        </div>
                        <div class="amenity-item" style="display: flex;gap:10px;margin-bottom: 10px;">
                            <img src="/icons/circleorange.svg" alt="orange Circle">
                            <p class="amentiy">Swimming Pool</p>
                        </div>
                        <div class="amenity-item" style="display: flex;gap:10px;margin-bottom: 10px;">
                            <img src="/icons/circleorange.svg" alt="orange Circle">
                            <p class="amentiy">Room service</p>
                        </div>
                        <div class="amenity-item" style="display: flex;gap:10px;margin-bottom: 10px;">
                            <img src="/icons/circleorange.svg" alt="orange Circle">
                            <p class="amentiy">Laundry service</p>
                        </div>
                        <div class="amenity-item" style="display: flex;gap:10px;margin-bottom: 10px;">
                            <img src="/icons/circleorange.svg" alt="orange Circle">
                            <p class="amentiy">Luggage storage</p>
                        </div>
                    </div>
                </div>

            </div>

            <div class="locations">
                <div class="hotelmap">

                    <iframe th:src="${hotel.mapSource}" width="600" height="450" style="border:0;" allowfullscreen=""
                        loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                    <div class="locationDetails">
                        <p class="hotelLocation" th:text="${hotel.address.addressLine1}"></p>
                        <a href="#" class="view-larger-map" id="viewMapBtn">View larger map</a>
                        <a href="#" class="seeMore">See More</a>
                    </div>
                </div>
                <div class="nearbyLocation">

                </div>
                <!-- Modal -->
                <div id="mapModal" class="modal">
                    <div class="modal-content">
                        <span class="close-btn" id="closeModalBtn">&times;</span>
                        <iframe id="modalMap" width="800" height="600" style="border:0;" allowfullscreen=""
                            loading="lazy"></iframe>
                    </div>
                </div>
            </div>
        </section>

        <section class="rooms-accessiblity" id="accessibility">
            <h1 class="title" style="text-align: center;">Choose Your Rooms</h1>
            <div class="rooms-details">
                <section class="filter-container">
                    <div class="filterbox">
                        <label for="personCount" class="filter-title">No of Persons</label>
                        <div class="numberInput">
                            <button type="button" class="decreaseBtn" onclick="updatePersonCount(-1)">-</button>
                            <input type="text" id="personCount" name="person" class="numberInputField" value="1">
                            <button type="button" class="increaseBtn" onclick="updatePersonCount(1)">+</button>
                        </div>
                    </div>

                    <div class="filterbox">
                        <label for="checkinDate" class="filter-title">Check-in</label>
                        <div class="dateInputWrapper">
                            <input type="date" id="checkinDate" name="checkin" class="dateInputField"
                                placeholder="Select date">
                        </div>
                    </div>


                    <div class="filterbox">
                        <label for="checkoutDate" class="filter-title">Check-out</label>
                        <div class="dateInputWrapper">
                            <input type="date" id="checkoutDate" name="checkout" class="dateInputField"
                                placeholder="Select date">
                        </div>
                    </div>

                    <a class="search-btn" id="reserveHotel">
                        Reserve
                    </a>
                </section>


                <div class="filterBtns">
                    <p class="filterbtn active" data-room-type="all">All</p>
                    <p class="filterbtn" data-room-type="Single">1 Bed</p>
                    <p class="filterbtn" data-room-type="Double">2 Bed</p>
                </div>

                <div class="rooms-accessiblity active" id="roomDetailsBox">
                    <th:block th:each="room : ${rooms}">
                        <th:block th:if="${room.hotel != null} and (${room.hotel.hotelId} == ${hotel.hotelId})">
                            <div class="roomdetail" th:data-room-type="${room.roomType}"
                                th:data-max-guests="${room.maxGuests}">
                                <div class="room-detail">
                                    <img class="roomImage"
                                        th:src="'data:image/jpeg;base64,' + ${room.primaryRoomImageBase64}"
                                        alt="Room Image">
                                    <p class="roomOffer">20% Off</p>
                                </div>

                                <div class="featureBox">

                                    <div class="roomFeature" style="display: block;">
                                        <div th:each="amenity : ${room.amenities}"
                                            style="display: flex;margin-bottom: 5px;">
                                            <img th:src="@{${amenity.name == 'Bed' ? '/icons/bed.svg' : 
                                                             amenity.name == 'Smart TV' ? '/icons/tv.svg' : 
                                                             amenity.name == 'Parking' ? '/icons/parking.svg' : 
                                                             amenity.name == 'No Smoking' ? '/icons/nosmoke.svg' : 
                                                             amenity.name == 'Shower' ? '/icons/shower.svg' : 
                                                             amenity.name == 'City View' ? '/icons/city.svg' : 
                                                             amenity.name=='Free Wi-Fi'?'/icons/wifi.svg' :
                                                             amenity.name=='24/7 Room Service'?'/icons/room.svg':
                                                             amenity.name=='Parking'?'/icons/locationblack.svg':
                                                             amenity.name=='Private Dining Experiences'?'/icons/dining.svg':
                                                             '/icons/filterorange.svg'}}"
                                                th:alt="${amenity.name + ' Icon'}" class="icons">
                                            <p th:text="${amenity.name}"></p>


                                        </div>
                                        <div class="roomFeature">
                                            <img src="/icons/bed.svg" alt="tv" class="icons">
                                            <p>
                                                <span
                                                    th:text="${room.maxGuests == 1 ? 'Single Bed' : 
                                                                room.maxGuests == 2 ? 'Double Bed' : 
                                                                room.maxGuests == 3 ? 'Queen Bed' : 
                                                                (room.maxGuests >= 4 && room.maxGuests <= 6) ? 'King Bed' : 'Invalid Guests'}">
                                                </span>
                                            </p>

                                        </div>
                                    </div>
                                    <p class="roomPrice">â‚¹ <span th:text="${room.pricePerNight}"></span></p>
                                    <!--  <a class="reserveBtn" 
                                    th:href="@{'/reserve?roomId=' + ${room.roomId} + '&roomType=' + ${room.roomType} + '&price=' + ${room.pricePerNight} + '&maxGuests=' + ${room.maxGuests}}">
                                    Reserve
                                 </a> -->
                                    <!-- <form th:action="@{/reserves}" method="post">
                                        <input type="hidden" name="roomId" th:value="${room.roomId}">
                                        <input type="hidden" name="roomType" th:value="${room.roomType}">
                                        <input type="hidden" name="price" th:value="${room.pricePerNight}">
                                        <input type="hidden" name="maxGuests" th:value="${room.maxGuests}">
                                        <input type="hidden" id="hiddenCheckinDate" name="checkinDate">
                                        <input type="hidden" id="hiddenCheckoutDate" name="checkoutDate">
                                        <button type="submit" class="reserveBtn">Reserve</button>
                                    </form> -->
                                    <form th:action="@{/reserves}" method="post">
                                        <input type="hidden" name="roomId" th:value="${room.roomId}">
                                        <input type="hidden" name="roomType" th:value="${room.roomType}">
                                        <input type="hidden" name="price" th:value="${room.pricePerNight}">
                                        <input type="hidden" name="maxGuests" th:value="${room.maxGuests}">
                                        <input type="hidden" id="hiddenCheckinDate" name="checkinDate">
                                        <input type="hidden" id="hiddenCheckoutDate" name="checkoutDate">
                                        <input type="hidden" id="roomCount" th:value="${room.roomCount}" />
                                        <button type="submit" class="reserveBtn">Reserve</button>
                                    </form>




                                    <!--  <p class="seeMore">
                                        <p><span th:text="${room.hotel.name}"></span></p>
                                        <a class="seeMore" href="/review-link">
                                            <p>See More</p>
                                            <img src="/icons/arrowright.svg" alt="Arrow Right">
                                        </a>
                                    </p>
                                     -->

                                </div>
                            </div>
                        </th:block>
                    </th:block>
                </div>


            </div>


            <section class="commonAreas">
                <div class="accessibility">

                </div>
                <div class="commonarea">
                    <!-- <h1>Common Areas</h1> -->


                </div>

            </section>


        </section>


        <section class="hotelListContainer">
            <div class="listTitle">
                <h1>Explore Our Best List of Hotel!</h1>
            </div>

            <div class="container" style="margin-top: 40px; max-width: 100%;">
                <div class="hotellists" id="hotelsList1" style="width: 100%; gap: 0;">
                    <div th:each="hotel : ${hotelsList1}" class="col-md-4 mb-2" style="max-width: 540px; margin: 10px;">
                        <a th:href="@{/sub-hotels(hotelId=${hotel.hotelId})}"
                            style="text-decoration: none; color: inherit;">
                            <div class="row g-0" id="sub">
                                <div class="hotel-image">
                                    <!-- Render hotel image if available -->
                                    <img th:if="${hotel.primaryHotelImageBase64 != null}"
                                        th:src="'data:image/jpeg;base64,' + ${hotel.primaryHotelImageBase64}"
                                        alt="Hotel Image" style="width: 90%; height: 250px; object-fit: cover;">
                                </div>

                                <div class="col-md-8">
                                    <div class="card-body">
                                        <h5 class="card-title" th:text="${hotel.name}">Hotel Name</h5>
                                        <p class="card-text" th:text="${hotel.address.addressLine2}">Hotel Description
                                        </p>
                                        <p class="card-text">
                                            <small class="text-muted">
                                                Rating: <span class="rating-value" th:text="${hotel.rating}">4</span>
                                                <span class="stars-container"></span>
                                            </small>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

        </section>
    </div>

    <script type="module" th:src="@{/JS/hotels.js}"></script>
    <script>
        //map
document.getElementById("viewMapBtn").addEventListener("click", function(e) {
    e.preventDefault();  // Prevent default link behavior
    var modal = document.getElementById("mapModal");
    var iframe = document.getElementById("modalMap");

    // Set the iframe's source to the map link from the current page
    iframe.src = document.querySelector("iframe").src;

    // Show the modal
    modal.style.display = "block";
});

document.getElementById("closeModalBtn").addEventListener("click", function() {
    var modal = document.getElementById("mapModal");
    var iframe = document.getElementById("modalMap");

    // Close the modal and clear the iframe src to stop the map from continuing to load
    modal.style.display = "none";
    iframe.src = "";
});



        function setMainImage(index) {
            // Get the clicked image's src
            const sideImages = document.querySelectorAll("#side-image img");
            const clickedImageSrc = sideImages[index].getAttribute("src");

            // Update the main image's src
            document.getElementById("mainimage").setAttribute("src", clickedImageSrc);
        }


        function toggleSection(sectionId) {
            // Remove 'active' class from all tabs
            document.querySelectorAll('.roomsDetails p').forEach(tab => tab.classList.remove('active'));

            // Add 'active' class to the clicked tab
            document.querySelector(`.${sectionId === 'overview' ? 'overview' : 'booking'}`).classList.add('active');

            // Hide all sections
            document.querySelectorAll('section').forEach(section => section.classList.remove('active'));

            // Show the selected section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            } else {
                console.error(`Section with ID "${sectionId}" not found.`);
            }
        }



        /* for filter section */

        function updatePersonCount(change) {
            const inputField = document.getElementById('personCount');
            let currentValue = parseInt(inputField.value) || 0;

            // Adjust the value within valid bounds
            let newValue = currentValue + change;
            if (newValue < 1) newValue = 1; // Minimum 1 person
            if (newValue > 10) newValue = 10; // Maximum 10 persons

            inputField.value = newValue;
        }

        // Prevent non-numeric input
        document.getElementById('personCount').addEventListener('input', function (e) {
            const value = e.target.value;
            if (!/^\d*$/.test(value)) {
                e.target.value = value.replace(/\D/g, ''); // Remove non-numeric characters
            }
        });



        /* filtering room details */

        document.getElementById('reserveHotel').addEventListener('click', function () {
            const personCount = document.getElementById('personCount').value;
            const checkinDate = document.getElementById('checkinDate').value;
            const checkoutDate = document.getElementById('checkoutDate').value;

            const roomDetailsBox = document.getElementById('roomDetailsBox');
            const allRooms = roomDetailsBox.querySelectorAll('.roomdetail');

            if (!personCount || !checkinDate || !checkoutDate) {
                // Display default room details
                allRooms.forEach(room => {
                    room.style.display = "block"; // Show all rooms
                });
                return;
            }

            // Filter room details based on the number of persons
            allRooms.forEach(room => {
                const maxGuests = parseInt(room.getAttribute('data-max-guests')); // Add a data-max-guests attribute to roomdetail
                const isWithinGuests = maxGuests >= parseInt(personCount);

                if (isWithinGuests) {
                    room.style.display = "flex"; // Show matching rooms
                } else {
                    room.style.display = "none"; // Hide rooms that don't match
                }
            });
        });



        /* check-in validation */
        document.addEventListener('DOMContentLoaded', function () {
            const checkinDateInput = document.getElementById('checkinDate');
            const checkoutDateInput = document.getElementById('checkoutDate');

            // Function to format a date as YYYY-MM-DD
            function formatDate(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            // Set initial min date for check-in
            const today = new Date();
            checkinDateInput.setAttribute('min', formatDate(today));

            // Update the min date for checkout when check-in is selected
            checkinDateInput.addEventListener('change', function () {
                const checkinDate = new Date(this.value);
                if (isNaN(checkinDate.getTime())) return;

                // Add 2 days to the check-in date for minimum checkout date
                const minCheckoutDate = new Date(checkinDate);
                minCheckoutDate.setDate(minCheckoutDate.getDate() + 2);

                checkoutDateInput.setAttribute('min', formatDate(minCheckoutDate));
                checkoutDateInput.value = ""; // Reset the checkout date if invalid
            });
        });



        /* dynamic date population */

        document.querySelectorAll('.reserveBtn').forEach(button => {
            button.addEventListener('click', function (event) {
                const hiddenCheckin = button.closest('form').querySelector('#hiddenCheckinDate');
                const hiddenCheckout = button.closest('form').querySelector('#hiddenCheckoutDate');
                hiddenCheckin.value = document.getElementById('checkinDate').value;
                hiddenCheckout.value = document.getElementById('checkoutDate').value;
            });
        });



        /*
        
        document.addEventListener("DOMContentLoaded", function () {
            // Handle Person Dropdown
            const personFilter = document.querySelector(".filterbox[data-type='Persons']");
            const personDropdown = personFilter.querySelector(".dropdownContent");
            const personSelectedText = personFilter.querySelector(".filter-input .selectedText");
        
            personFilter.addEventListener("click", function (event) {
                event.stopPropagation(); // Prevents closing dropdown immediately
                personDropdown.classList.toggle("show");
            });
        
            personDropdown.querySelectorAll(".listItem input").forEach((input) => {
                input.addEventListener("change", function () {
                    personSelectedText.textContent = input.labels[0].textContent;
                    personDropdown.classList.remove("show");
                });
            });
        
            // Handle Check-in Date Picker
            const checkinFilter = document.querySelector(".filterbox[data-type='Check-in'] .filter-input");
            const checkinSelectedText = checkinFilter.querySelector(".selectedText");
        
            checkinFilter.addEventListener("click", function (event) {
                event.stopPropagation(); // Prevent dropdown conflicts
        
                // Create visible date input
                const checkinInput = document.createElement("input");
                checkinInput.type = "date";
                checkinInput.style.position = "absolute";
                checkinInput.style.opacity = "2"; // Make input visible
                checkinInput.style.zIndex = "1400"; // Ensure it's above other elements
                document.body.appendChild(checkinInput);
        
                // Position the date picker relative to the checkinFilter
                const rect = checkinFilter.getBoundingClientRect();
                checkinInput.style.left = `${rect.left}px`;
                checkinInput.style.top = `${rect.bottom + window.scrollY}px`;
        
                checkinInput.focus(); // Open date picker
        
                // Handle date selection
                checkinInput.addEventListener("change", function () {
                    if (checkinInput.value) {
                        checkinSelectedText.textContent = checkinInput.value;
                    }
                    document.body.removeChild(checkinInput); // Clean up
                });
        
                // Close date picker if clicked outside
                checkinInput.addEventListener("blur", function () {
                    document.body.removeChild(checkinInput); // Clean up on blur
                });
            });
        
            // Handle Check-out Date Picker
            const checkoutFilter = document.querySelector(".filterbox[data-type='Check-out'] .filter-input");
            const checkoutSelectedText = checkoutFilter.querySelector(".selectedText");
        
            checkoutFilter.addEventListener("click", function (event) {
                event.stopPropagation(); // Prevent dropdown conflicts
        
                // Create visible date input
                const checkoutInput = document.createElement("input");
                checkoutInput.type = "date";
                checkoutInput.style.position = "absolute";
                checkoutInput.style.opacity = "1"; // Make input visible
                checkoutInput.style.zIndex = "1000"; // Ensure it's above other elements
                document.body.appendChild(checkoutInput);
        
                // Position the date picker relative to the checkoutFilter
                const rect = checkoutFilter.getBoundingClientRect();
                checkoutInput.style.left = `${rect.left}px`;
                checkoutInput.style.top = `${rect.bottom + window.scrollY}px`;
        
                checkoutInput.focus(); // Open date picker
        
                // Handle date selection
                checkoutInput.addEventListener("change", function () {
                    if (checkoutInput.value) {
                        checkoutSelectedText.textContent = checkoutInput.value;
                    }
                    document.body.removeChild(checkoutInput); // Clean up
                });
        
                // Close date picker if clicked outside
                checkoutInput.addEventListener("blur", function () {
                    document.body.removeChild(checkoutInput); // Clean up on blur
                });
            });
        
            // Close dropdown when clicking outside
            document.addEventListener("click", function (event) {
                if (!personFilter.contains(event.target)) {
                    personDropdown.classList.remove("show");
                }
            });
        });
        */

        /*
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize date pickers
            const checkInPicker = new Datepicker(document.querySelector('.filterbox[data-type="Check-in"] .filter-input'), {
                format: 'yyyy-mm-dd',
                minDate: new Date(),
                autohide: true,
                todayHighlight: true
            });
        
            const checkOutPicker = new Datepicker(document.querySelector('.filterbox[data-type="Check-out"] .filter-input'), {
                format: 'yyyy-mm-dd',
                minDate: new Date(),
                autohide: true,
                todayHighlight: true
            });
        
            // Update selected text when dates are chosen
            checkInPicker.element.addEventListener('changeDate', function(e) {
                const selectedText = e.target.closest('.filterbox').querySelector('.selectedText');
                selectedText.textContent = e.detail.date.toISOString().split('T')[0];
                checkOutPicker.setMinDate(e.detail.date);
            });
        
            checkOutPicker.element.addEventListener('changeDate', function(e) {
                const selectedText = e.target.closest('.filterbox').querySelector('.selectedText');
                selectedText.textContent = e.detail.date.toISOString().split('T')[0];
            });
        
            // Handle person selection dropdown
            const personDropdown = document.querySelector('.filterbox[data-type="Persons"]');
            const personOptions = personDropdown.querySelectorAll('input[type="radio"]');
            
            personOptions.forEach(option => {
                option.addEventListener('change', function() {
                    const selectedText = personDropdown.querySelector('.selectedText');
                    selectedText.textContent = this.parentElement.querySelector('label').textContent;
                });
            });
        });
        
        */


        // Room filtering functionality
        /* 
        document.getElementById("reserveHotel").addEventListener("click", function() {
            clearErrors();
           
            const personInput = document.querySelector('input[name="person"]:checked');
            const checkInDate = document.querySelector('.filterbox[data-type="Check-in"] .selectedText').textContent;
            const checkOutDate = document.querySelector('.filterbox[data-type="Check-out"] .selectedText').textContent;
        
           
            if (!validateInputs(personInput, checkInDate, checkOutDate)) {
                return;
            }
        
            
            showLoading();
        
        
            const personCountMap = {
                'one': '1',
                'two': '2',
                'four': '4',
                'six': '6'
            };
            const personCount = personCountMap[personInput.id];
        
            fetchAvailableRooms(personCount, checkInDate, checkOutDate)
                .then(response => {
                    if (!response.success) {
                        throw new Error(response.message);
                    }
                    return response.data;
                })
                .then(handleRoomResults)
                .catch(handleError)
                .finally(hideLoading);
        }); */



        function reserveHotel() {
            // Try to get the hotelId value from a hidden input
            const hotelIdElement = document.getElementById('hotelId');
            if (hotelIdElement) {
                const hotelId = hotelIdElement.value;
                console.log('Hotel ID:', hotelId);  // Check in the console if hotelId is correctly fetched
                // Your reservation logic here, for example:
                // window.location.href = `sub-hotels?hotelId=${hotelId}`;
            } else {
                console.error('Hotel ID element not found');
            }
        }

        // Alternatively, you can fetch hotelId from the URL query string
        function reserveHotelFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const hotelId = urlParams.get('hotelId');
            if (hotelId) {
                console.log('Hotel ID from URL:', hotelId);  // Check in the console if hotelId is correctly fetched
            } else {
                console.error('Hotel ID not found in URL');
            }
        }

        // Call the function when needed, for example on page load
        reserveHotelFromURL();




        document.getElementById("reserveHotel").addEventListener("click", function () {
            clearErrors();

            // Get and validate inputs
            const hotelId = document.querySelector('input[name="hotelId"]').value; // Update based on your HTML
            const personInput = document.querySelector('input[name="person"]:checked');
            const checkInDate = document.querySelector('.filterbox[data-type="Check-in"] .selectedText').textContent;
            const checkOutDate = document.querySelector('.filterbox[data-type="Check-out"] .selectedText').textContent;

            if (!validateInputs(hotelId, personInput, checkInDate, checkOutDate)) {
                return;
            }

            showLoading();

            const personCount = personCountMap[personInput.id];

            fetchAvailableRooms(hotelId, personCount, checkInDate, checkOutDate)
                .then(handleRoomResults)
                .catch(handleError)
                .finally(hideLoading);
        });


        function validateInputs(hotelId, personInput, checkInDate, checkOutDate) {
            if (!hotelId) {
                showError("Please select a hotel");
                return false;
            }

            if (!personInput) {
                showError("Please select the number of persons");
                return false;
            }

            if (checkInDate === 'Date' || checkOutDate === 'Date') {
                showError("Please select both check-in and check-out dates");
                return false;
            }

            if (!isValidDateRange(checkInDate, checkOutDate)) {
                showError("Invalid date range selected");
                return false;
            }

            return true;
        }

        function isValidDateRange(checkIn, checkOut) {
            const checkInDate = new Date(checkIn);
            const checkOutDate = new Date(checkOut);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            return checkInDate >= today && checkOutDate > checkInDate;
        }

        /* function fetchAvailableRooms(personCount, checkInDate, checkOutDate) {
            const params = new URLSearchParams({
                personCount: personCount,
                checkInDate: checkInDate,
                checkOutDate: checkOutDate
            });
        
            return fetch(`/rooms/availability?${params}`)
                .then(response => response.json())
                .catch(error => {
                    console.error('Network error:', error);
                    throw new Error('Failed to connect to the server');
                });
        } */

        function fetchAvailableRooms(hotelId, personCount, checkInDate, checkOutDate) {
            const params = new URLSearchParams({
                hotelId: hotelId,
                personCount: personCount,
                checkInDate: checkInDate,
                checkOutDate: checkOutDate
            });

            return fetch(`/rooms/availability?${params}`)
                .then(response => response.json())
                .catch(error => {
                    console.error('Network error:', error);
                    throw new Error('Failed to connect to the server');
                });
        }


        function handleRoomResults(rooms) {
            const roomDetailsBox = document.getElementById("roomDetailsBox");
            const filteredRoomList = document.createElement('div');
            filteredRoomList.id = 'filteredRoomList';
            filteredRoomList.className = 'filtered-rooms';

            if (!Array.isArray(rooms) || rooms.length === 0) {
                filteredRoomList.innerHTML = `
            <div class="no-rooms-message">
                <p>No rooms available for the selected criteria.</p>
            </div>
        `;
            } else {
                rooms.forEach(room => {
                    filteredRoomList.innerHTML += `
                <div class="roomdetail">
                    <div class="room-detail">
                        <img class="roomImage" src="data:image/jpeg;base64,${room.primaryRoomImageBase64}" alt="${room.roomType}">
                    </div>
                    <div class="featureBox">
                        <div class="roomFeaturesBox">
                            <div class="roomFeature">
                                <p class="title">${room.roomType}</p>
                            </div>
                            <div class="roomFeature">
                                <p class="roomPrice">$${room.pricePerNight}</p>
                            </div>
                            <div class="roomFeature">
                                <p>Max Guests: ${room.maxGuests}</p>
                            </div>
                            <div class="roomFeature">
                                <p>${room.isAvailable ? 'Available' : 'Not Available'}</p>
                            </div>
                            ${room.hotelName ? `
                            <div class="roomFeature">
                                <p>${room.hotelName}</p>
                            </div>
                            ` : ''}
                        </div>
                        <button class="reserveBtn" onclick="bookRoom(${room.roomId})">Book Now</button>
                    </div>
                </div>
            `;
                });
            }

            // Replace original content with filtered results
            roomDetailsBox.style.display = 'none';
            roomDetailsBox.parentNode.insertBefore(filteredRoomList, roomDetailsBox.nextSibling);
        }

        function clearErrors() {
            const existingError = document.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
        }

        function showError(message) {
            clearErrors();
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.querySelector('.filtercontainer').appendChild(errorDiv);
            setTimeout(() => errorDiv.remove(), 3000);
        }

        function handleError(error) {
            console.error('Error:', error);
            showError(error.message || 'An error occurred while fetching available rooms');
        }

        function showLoading() {
            const loader = document.createElement('div');
            loader.className = 'loader';
            loader.innerHTML = '<div class="spinner"></div>';
            document.querySelector('.rooms-details').appendChild(loader);
        }

        function hideLoading() {
            const loader = document.querySelector('.loader');
            if (loader) {
                loader.remove();
            }
        }

        function bookRoom(roomId) {
            // Implement booking functionality
            console.log(`Booking room ${roomId}`);
            // Add your booking logic here
        }



        document.addEventListener('DOMContentLoaded', function () {
            const filterButtons = document.querySelectorAll('.filterbtn');
            const rooms = document.querySelectorAll('.roomdetail');

            function filterRooms(filterValue) {
                rooms.forEach(room => {
                    const roomType = room.getAttribute('data-room-type');
                    console.log('Room:', room);
                    console.log('Room type:', roomType);
                    console.log('Filter value:', filterValue);

                    if (filterValue === 'all') {
                        room.style.display = '';
                    } else {
                        // Convert both to same case for comparison
                        room.style.display = (roomType && roomType.toLowerCase() === filterValue.toLowerCase()) ? '' : 'none';
                    }
                });
            }

            // Show all rooms initially
            filterRooms('all');

            filterButtons.forEach(button => {
                button.addEventListener('click', function (e) {
                    e.preventDefault();

                    // Update active state
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    // Get filter value and apply filtering
                    const filterValue = this.getAttribute('data-room-type');
                    filterRooms(filterValue);
                });
            });
        });

    </script>
</body>

</html>